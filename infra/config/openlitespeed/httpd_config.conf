# SPDX-License-Identifier: MIT
# SPDX-FileCopyrightText: 2025 Jonathan D. A. Jewell <hyperpolymath>
#
# OpenLiteSpeed Main Configuration for Project Wharf
# ===================================================
# Hardened configuration with security headers and WordPress optimizations.

serverName                Yacht
user                      nobody
group                     nogroup
priority                  0
autoRestart               1
chrootPath                /
enableChroot              0
inMemBufSize              60M
swappingDir               /tmp/lshttpd/swap
autoFix503                1
gracefulRestartTimeout    300
mime                      conf/mime.properties
showVersionNumber         0
adminEmails               root@localhost

errorlog logs/error.log {
    logLevel             WARN
    debugLevel           0
    rollingSize          10M
    enableStderrLog      1
}

accessLog logs/access.log {
    rollingSize          10M
    keepDays             7
    compressArchive      1
    logReferer           1
    logUserAgent         1
}

indexFiles               index.php, index.html

# -----------------------------------------------------------------------------
# Security Settings
# -----------------------------------------------------------------------------

# Prevent version disclosure
serverSignature          0

# Connection limits
maxConnections           2000
maxSSLConnections        1000
connTimeout              30
maxKeepAliveReq          10000
smartKeepAlive           1
keepAliveTimeout         5

# Request limits
maxReqURLLen             8192
maxReqHeaderSize         16380
maxReqBodySize           64M
maxDynRespHeaderSize     8192
maxDynRespSize           256M

# Disable .htaccess override in most directories (use vhost config)
enableScript             1
enableExpires            1

# -----------------------------------------------------------------------------
# Listener Configuration
# -----------------------------------------------------------------------------

listener HTTP {
    address                *:8080
    secure                 0
    map                    wordpress *
}

listener HTTPS {
    address                *:8443
    secure                 1
    keyFile                /etc/letsencrypt/live/default/privkey.pem
    certFile               /etc/letsencrypt/live/default/fullchain.pem
    certChain              1
    sslProtocol            24
    ciphers                ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
    enableECDHE            1
    enableDHE              0
    renegProtection        1
    sslSessionCache        1
    sslSessionTickets      1
    enableSpdy             15
    enableQuic             1
    map                    wordpress *
}

# -----------------------------------------------------------------------------
# Virtual Host
# -----------------------------------------------------------------------------

virtualHost wordpress {
    vhRoot                 /var/www/html/
    configFile             conf/vhosts/wordpress/vhconf.conf
    allowSymbolLink        1
    enableScript           1
    restrained             0
}
