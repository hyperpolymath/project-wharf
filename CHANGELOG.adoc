// SPDX-License-Identifier: PMPL-1.0-or-later
= Changelog

All notable changes to Project Wharf will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

== [Unreleased]

=== Added
- Initial project structure
- Rust workspace with wharf-core, wharf-cli, and yacht-agent crates
- DNS zone templates (simple, shared, standard, maximalist)
- Nickel configuration schemas for security policies
- Database policy engine with AST-based SQL filtering (sqlparser 0.39)
- CMS adapters for WordPress, Drupal, Joomla, Moodle
- Shell scripts for zone rendering, auditing, and deployment
- Comprehensive Justfile with 50+ recipes
- RSR (Rhodium Standard Repository) compliance documentation

=== V1.0 Shipping Preparation (2026-02-14)
- *Signature scheme feature flag*: Ed448 now opt-in via `SignatureScheme::Hybrid`; default is `MlDsa87Only` (FIPS 204 peer-reviewed). Configurable via `--signature-scheme` CLI arg and TOML config.
- *SQL injection smoke tests*: 19 integration tests proving AST-based proxy blocks real WordPress attack patterns (user creation, options manipulation, content defacement, DDL, stacked injection)
- *Deployment package*: `deploy/setup.sh` first-run script + `deploy/DEPLOY.adoc` step-by-step guide with podman/selur-compose orchestration
- *Hack-me challenge*: `docs/HACK-ME-CHALLENGE.adoc` with rules of engagement, attack surface table, and technical details for security researchers
- *WordPress adapter plugin*: `adapters/wordpress-wharf/` — GPL-2.0-or-later PHP plugin providing dashboard widget (query stats, firewall mode, signature scheme) and admin bar indicator
- *systemd unit*: `infra/systemd/yacht-agent.service` with DynamicUser, ProtectSystem=strict, MemoryDenyWriteExecute, and CAP_BPF
- *Tooling enrollment*: Bot directives for gitbot-fleet (8 bots), panic-attacker security scan workflow, AI manifest updated
- *K9 contractiles*: Nickel configuration templates (Kennel/Yard/Hunt levels) for deployment automation

=== Production Hardening (2026-02-14)
- *Persistent hybrid keypairs*: Wharf CLI (`~/.wharf/keys/wharf.key`) and Yacht Agent (`/etc/wharf/keys/yacht.key`) now persist Ed448 + ML-DSA-87 keypairs across restarts with proper file permissions (0600 private, 0644 public)
- *Keypair serialization*: Custom binary format with `WHRF` magic, versioning, and optional password encryption via HKDF-SHAKE512 + XChaCha20-Poly1305
- *eBPF XDP firewall*: Full kernel-level packet filtering with XDP programs and userspace loader (`crates/wharf-ebpf/`)
- *Certificate management*: Complete Nebula certificate lifecycle — CA creation, cert signing, IP allocation, and revocation (`nebula.rs`)
- *Prometheus metrics*: Real-time counters for queries (allowed/blocked/audited), mooring sessions, integrity checks, and moored status at `GET /metrics`
- *Statistics endpoint*: `GET /stats` now returns actual counters instead of placeholder zeros
- *File integrity verification*: Yacht Agent mooring verify phase now checks BLAKE3 manifests against on-disk files when `site_root` is configured
- *HTTP client resilience*: Mooring client configured with 30s timeout, 10s connect timeout, and connection pooling (2 idle per host)
- *Configuration*: Added `key_store_dir` (CLI + agent) and `site_root` (agent) config options

=== Security
- Implemented AST-based SQL query analysis (not regex)
- Added HTTP header airlock configuration
- Defined filesystem immutability policies
- Configured Nebula mesh network policies
- Added FIDO2/WebAuthn authentication framework

=== Known Issues
- `ed448-goldilocks` v0.14.0-pre.10 is unaudited — needs third-party audit before production deployment

== [0.1.0] - 2025-11-26

=== Added
- Initial release of Project Wharf
- Core architecture: Wharf (offline controller) + Yacht (runtime enforcer)
- Database "Virtual Sharding" concept
- Zero Trust networking via Nebula
- Support for WordPress, Drupal, Joomla, Moodle

=== Documentation
- README.adoc with full architecture overview
- SECURITY.md with vulnerability reporting process
- CONTRIBUTING.adoc with TPCF contribution framework
- GOVERNANCE.adoc with decision-making process

---

== Version History Summary

| Version | Date | Highlights |
|---------|------|------------|
| Unreleased | 2026-02-14 | V1.0 shipping: signature scheme flag, SQLi tests, deployment package, WordPress adapter, hack-me challenge |
| 0.1.0 | 2025-11-26 | Initial release |

== Upgrade Guide

=== Upgrading to 0.1.0

This is the initial release. No upgrade path required.

== Deprecation Notices

*None at this time.*

== Security Advisories

*None at this time.*

---

[Unreleased]: https://gitlab.com/hyperpolymath/wharf/-/compare/v0.1.0...HEAD
[0.1.0]: https://gitlab.com/hyperpolymath/wharf/-/releases/v0.1.0
